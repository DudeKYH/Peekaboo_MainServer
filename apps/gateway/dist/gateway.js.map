{
  "version": 3,
  "sources": ["../src/gateway.js"],
  "sourcesContent": ["import TcpServer from '@peekaboo-ssr/classes/TcpServer';\r\nimport TcpClient from '@peekaboo-ssr/classes/TcpClient';\r\nimport C2GEventHandler from './events/onC2G.event.js';\r\nimport S2GEventHandler from './events/onS2G.event.js';\r\nimport config from '@peekaboo-ssr/config/gateway';\r\nimport { mapClients } from './source/router.source.js';\r\n\r\nclass GatewayServer extends TcpServer {\r\n  constructor() {\r\n    super(\r\n      'gateway',\r\n      config.gateway.host,\r\n      config.gateway.port,\r\n      new C2GEventHandler(),\r\n    );\r\n    this.S2GEventHandler = new S2GEventHandler();\r\n    this.index = 0;\r\n\r\n    // Distributor\uB791 \uC5F0\uACB0\uC740 \uC5EC\uAE30\uC11C \uD574\uACB0\uD558\uBA74 \uB420\uAC70\uAC19\uACE0..\r\n    this.connectToDistributor(\r\n      config.distributor.host,\r\n      config.distributor.port,\r\n      (data) => {\r\n        console.log('Distributor Notification: ', data);\r\n      },\r\n    );\r\n  }\r\n\r\n  // \uAC01 \uC11C\uBE44\uC2A4\uAC04 \uC5F0\uACB0\uC774 \uD544\uC694\r\n  // \uAC8C\uC774\uD2B8\uC6E8\uC774 mapClients\uC5D0 \uC5F0\uACB0\uB41C \uB178\uB4DC \uC815\uBCF4\uB97C \uC800\uC7A5\uD558\uB294 \uD568\uC218\r\n  onDistribute(data) {\r\n    for (let i in data.microservices) {\r\n      const node = data.microservices[i];\r\n      const key = node.host + ':' + node.port;\r\n      if (!mapClients[key] && node.name !== 'gateway') {\r\n        const client = new TcpClient(\r\n          node.host,\r\n          node.port,\r\n          (options) => {\r\n            this.S2GEventHandler.onConnection(client);\r\n          },\r\n          (options, data) => {\r\n            this.S2GEventHandler.onData(client, data);\r\n          },\r\n          () => {\r\n            this.S2GEventHandler.onEnd(client);\r\n          },\r\n          () => {\r\n            this.S2GEventHandler.onError(client);\r\n          },\r\n        );\r\n\r\n        mapClients[key] = {\r\n          client: client,\r\n          info: node,\r\n        };\r\n\r\n        client.connect();\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nnew GatewayServer();\r\n"],
  "mappings": "AAAA,OAAO,eAAe;AACtB,OAAO,eAAe;AACtB,OAAO,qBAAqB;AAC5B,OAAO,qBAAqB;AAC5B,OAAO,YAAY;AACnB,SAAS,kBAAkB;AAE3B,MAAM,sBAAsB,UAAU;AAAA,EACpC,cAAc;AACZ;AAAA,MACE;AAAA,MACA,OAAO,QAAQ;AAAA,MACf,OAAO,QAAQ;AAAA,MACf,IAAI,gBAAgB;AAAA,IACtB;AACA,SAAK,kBAAkB,IAAI,gBAAgB;AAC3C,SAAK,QAAQ;AAGb,SAAK;AAAA,MACH,OAAO,YAAY;AAAA,MACnB,OAAO,YAAY;AAAA,MACnB,CAAC,SAAS;AACR,gBAAQ,IAAI,8BAA8B,IAAI;AAAA,MAChD;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA,EAIA,aAAa,MAAM;AACjB,aAAS,KAAK,KAAK,eAAe;AAChC,YAAM,OAAO,KAAK,cAAc,CAAC;AACjC,YAAM,MAAM,KAAK,OAAO,MAAM,KAAK;AACnC,UAAI,CAAC,WAAW,GAAG,KAAK,KAAK,SAAS,WAAW;AAC/C,cAAM,SAAS,IAAI;AAAA,UACjB,KAAK;AAAA,UACL,KAAK;AAAA,UACL,CAAC,YAAY;AACX,iBAAK,gBAAgB,aAAa,MAAM;AAAA,UAC1C;AAAA,UACA,CAAC,SAASA,UAAS;AACjB,iBAAK,gBAAgB,OAAO,QAAQA,KAAI;AAAA,UAC1C;AAAA,UACA,MAAM;AACJ,iBAAK,gBAAgB,MAAM,MAAM;AAAA,UACnC;AAAA,UACA,MAAM;AACJ,iBAAK,gBAAgB,QAAQ,MAAM;AAAA,UACrC;AAAA,QACF;AAEA,mBAAW,GAAG,IAAI;AAAA,UAChB;AAAA,UACA,MAAM;AAAA,QACR;AAEA,eAAO,QAAQ;AAAA,MACjB;AAAA,IACF;AAAA,EACF;AACF;AAEA,IAAI,cAAc;",
  "names": ["data"]
}
