{
  "version": 3,
  "sources": ["../src/events/onG2S.event.js"],
  "sourcesContent": ["import config from '@peekaboo-ssr/config/lobby';\r\nimport BaseEvent from '@peekaboo-ssr/events/BaseEvent';\r\n\r\nclass G2SEventHandler extends BaseEvent {\r\n  onConnection(socket) {\r\n    console.log(\r\n      `Gate connected from: ${socket.remoteAddress}:${socket.remotePort}`,\r\n    );\r\n    socket.buffer = Buffer.alloc(0);\r\n  }\r\n\r\n  async onData(socket, data) {\r\n    console.log('Service\uAC00 \uAC8C\uC774\uD2B8\uB85C\uBD80\uD130 \uB370\uC774\uD130\uB97C \uBC1B\uC74C..');\r\n    socket.buffer = Buffer.concat([socket.buffer, data]);\r\n\r\n    while (socket.buffer.length >= config.header.service.typeLength) {\r\n      let offset = 0;\r\n      const packetType = socket.buffer.readUint16BE(offset);\r\n      offset += config.header.service.typeLength;\r\n\r\n      const payloadLength = socket.buffer.readUint32BE(offset);\r\n      offset += config.header.service.payloadLength;\r\n\r\n      const totalPacketLength = offset + payloadLength;\r\n\r\n      if (socket.buffer.length < totalPacketLength) {\r\n        break;\r\n      }\r\n      const payload = socket.buffer\r\n        .subarray(offset, offset + payloadLength)\r\n        .toString('utf-8');\r\n\r\n      socket.buffer = socket.buffer.subarray(totalPacketLength);\r\n\r\n      try {\r\n        const payloadObj = JSON.parse(payload);\r\n\r\n        console.log(packetType);\r\n\r\n        const handler = getHandlerByPacketType(packetType);\r\n\r\n        await handler(socket, payloadObj);\r\n      } catch (e) {\r\n        console.error(e);\r\n        process.exit(1);\r\n      }\r\n    }\r\n  }\r\n\r\n  onEnd(socket) {\r\n    console.log('onClose', socket.remoteAddress, socket.remotePort);\r\n  }\r\n\r\n  onError(socket, err) {\r\n    console.log('onClose', socket.remoteAddress, socket.remotePort);\r\n  }\r\n}\r\n\r\nexport default G2SEventHandler;\r\n"],
  "mappings": "AAAA,OAAO,YAAY;AACnB,OAAO,eAAe;AAEtB,MAAM,wBAAwB,UAAU;AAAA,EACtC,aAAa,QAAQ;AACnB,YAAQ;AAAA,MACN,wBAAwB,OAAO,aAAa,IAAI,OAAO,UAAU;AAAA,IACnE;AACA,WAAO,SAAS,OAAO,MAAM,CAAC;AAAA,EAChC;AAAA,EAEA,MAAM,OAAO,QAAQ,MAAM;AACzB,YAAQ,IAAI,4FAA2B;AACvC,WAAO,SAAS,OAAO,OAAO,CAAC,OAAO,QAAQ,IAAI,CAAC;AAEnD,WAAO,OAAO,OAAO,UAAU,OAAO,OAAO,QAAQ,YAAY;AAC/D,UAAI,SAAS;AACb,YAAM,aAAa,OAAO,OAAO,aAAa,MAAM;AACpD,gBAAU,OAAO,OAAO,QAAQ;AAEhC,YAAM,gBAAgB,OAAO,OAAO,aAAa,MAAM;AACvD,gBAAU,OAAO,OAAO,QAAQ;AAEhC,YAAM,oBAAoB,SAAS;AAEnC,UAAI,OAAO,OAAO,SAAS,mBAAmB;AAC5C;AAAA,MACF;AACA,YAAM,UAAU,OAAO,OACpB,SAAS,QAAQ,SAAS,aAAa,EACvC,SAAS,OAAO;AAEnB,aAAO,SAAS,OAAO,OAAO,SAAS,iBAAiB;AAExD,UAAI;AACF,cAAM,aAAa,KAAK,MAAM,OAAO;AAErC,gBAAQ,IAAI,UAAU;AAEtB,cAAM,UAAU,uBAAuB,UAAU;AAEjD,cAAM,QAAQ,QAAQ,UAAU;AAAA,MAClC,SAAS,GAAG;AACV,gBAAQ,MAAM,CAAC;AACf,gBAAQ,KAAK,CAAC;AAAA,MAChB;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,QAAQ;AACZ,YAAQ,IAAI,WAAW,OAAO,eAAe,OAAO,UAAU;AAAA,EAChE;AAAA,EAEA,QAAQ,QAAQ,KAAK;AACnB,YAAQ,IAAI,WAAW,OAAO,eAAe,OAAO,UAAU;AAAA,EAChE;AACF;AAEA,IAAO,sBAAQ;",
  "names": []
}
